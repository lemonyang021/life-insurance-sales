<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd                               http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="uuid_type" value="RAW(16)" dbms="oracle" />
	<property name="uuid_type" value="BINARY(16)" dbms="mysql" />
	<property name="uuid_type" value="uniqueidentifier" dbms="mssql" />
	<property name="pk" value="PK_CLAIM_PAYEE" dbms="mssql,oracle,postgresql" />
	<property name="pk" value="PRIMARY" dbms="mysql" />
	<property name="current_datetime" value="sysdate" dbms="oracle" />
	<property name="current_datetime" value="current_timestamp"
		dbms="mssql" />
	<property name="current_datetime" value="now()" dbms="mysql,postgresql" />

	<changeSet author="generated" id="T_CLAIM_PAYEE">
		<createTable tableName="T_CLAIM_PAYEE">
			<column name="PAYEE_ID" type="${uuid_type}">
				<constraints nullable="false" />
			</column>
			<column name="EXTRA_PROPS" type="VARCHAR(200)" />
			<column name="INSERT_TIME" type="datetime" />
			<column name="INSERT_TIMESTAMP" type="datetime" />
			<column name="INSERTED_BY" type="BIGINT" />
			<column name="UPDATE_TIME" type="datetime" />
			<column name="UPDATE_TIMESTAMP" type="datetime" />
			<column name="UPDATED_BY" type="BIGINT" />
			<column name="CASE_ID" type="${uuid_type}" />
			<column name="PAYEE_NAME" type="VARCHAR(100)" />
			<column name="CERTI_TYPE" type="VARCHAR(2)" />
			<column name="CERTI_CODE" type="VARCHAR(50)" />
			<column name="PAY_AMOUNT" type="DECIMAL(18, 2)" />
		</createTable>
	</changeSet>

	<changeSet author="generated" id="PRIMARY">
		<addPrimaryKey columnNames="PAYEE_ID" constraintName="${pk}"
			tableName="T_CLAIM_PAYEE" />
	</changeSet>

	<changeSet author="xin.shi" id="T_CLAIM_PAYEE.DECIMAL.CHANGE"
		runOnChange="true">
		<modifyDataType columnName="PAY_AMOUNT" newDataType="DECIMAL(18, 6)"
			tableName="T_CLAIM_PAYEE" />
	</changeSet>
	
	<changeSet author="xin.shi" id="modify certi code length" >
		<modifyDataType columnName="CERTI_CODE"
			newDataType="VARCHAR2(400)" tableName="T_CLAIM_PAYEE" />
	</changeSet>
	<changeSet author="xin.shi" id="add certi code encrypt" dbms='mysql'>
		<sql endDelimiter=";" stripComments="true">SET @@session.block_encryption_mode:='aes-256-cbc';</sql>
		<update 
			tableName="T_CLAIM_PAYEE">
			<column name="CERTI_CODE" valueComputed="CONCAT('{{##AES##}}',TO_BASE64(AES_ENCRYPT(CERTI_CODE, '${aes256key}', '${aes256iv}')))" />
			<where>LEFT(CERTI_CODE,11) != '{{##AES##}}'</where>
		</update>
	</changeSet>
    
    <changeSet author="generated" id="createIndex-claim-payee-caseId">
      <createIndex indexName="idx_claim_payee_caseId" tableName="T_CLAIM_PAYEE">
        <column name="CASE_ID" type="${uuid_type}" />
      </createIndex>
    </changeSet>
</databaseChangeLog>
