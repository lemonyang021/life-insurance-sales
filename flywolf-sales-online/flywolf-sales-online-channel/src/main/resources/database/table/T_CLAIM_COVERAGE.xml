<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd                               http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="uuid_type" value="RAW(16)" dbms="oracle" />
	<property name="uuid_type" value="BINARY(16)" dbms="mysql" />
	<property name="uuid_type" value="uniqueidentifier" dbms="mssql" />
	<property name="pk" value="PK_CLAIM_COVERAGE" dbms="mssql,oracle,postgresql" />
	<property name="pk" value="PRIMARY" dbms="mysql" />
	<property name="current_datetime" value="sysdate" dbms="oracle" />
	<property name="current_datetime" value="current_timestamp"
		dbms="mssql" />
	<property name="current_datetime" value="now()" dbms="mysql,postgresql" />

	<changeSet author="generated" id="T_CLAIM_COVERAGE">
		<createTable tableName="T_CLAIM_COVERAGE">
			<column name="CLAIM_COVERAGE_ID" type="${uuid_type}">
				<constraints nullable="false" />
			</column>
			<column name="EXTRA_PROPS" type="VARCHAR(200)" />
			<column name="INSERT_TIME" type="datetime" />
			<column name="INSERT_TIMESTAMP" type="datetime" />
			<column name="INSERTED_BY" type="BIGINT" />
			<column name="UPDATE_TIME" type="datetime" />
			<column name="UPDATE_TIMESTAMP" type="datetime" />
			<column name="UPDATED_BY" type="BIGINT" />
			<column name="CLAIM_POLICY_ID" type="${uuid_type}" />
			<column name="COVERAGE_NO" type="VARCHAR(50)" />
			<column name="CLAIM_DECISION" type="INT" />
			<column name="PRODUCT_CODE" type="VARCHAR(50)" />
			<column name="LIABILITY_STATUS" type="INT" />
			<column name="REJECT_REASON" type="INT" />
			<column name="REJECT_REASON_DESC" type="VARCHAR(200)" />
			<column name="PAY_AMOUNT" type="DECIMAL(18, 2)" />
			<column name="BENEFIT_LEVEL" type="VARCHAR(20)" />
			<column name="PAYMENT_FREQUENCY" type="INT" />
			<column name="SUM_ASSURED" type="DECIMAL(18, 2)" />
			<column name="PREMIUM" type="DECIMAL(18, 2)" />
			<column name="UNIT" type="DECIMAL(18, 2)" />
			<column name="TERMINATE_INDI" type="INT" />
		</createTable>
	</changeSet>

	<changeSet author="generated" id="PRIMARY">
		<addPrimaryKey columnNames="CLAIM_COVERAGE_ID"
			constraintName="${pk}" tableName="T_CLAIM_COVERAGE" />
	</changeSet>

	<changeSet author="xin.shi" id="T_CLAIM_COVERAGE.NOTIFICATION_AMOUNT"
		runOnChange="true">
		<preConditions onFail="MARK_RAN" onFailMessage="NOTIFICATION_AMOUNT exists">
			<not>
				<columnExists tableName="T_CLAIM_COVERAGE" columnName="NOTIFICATION_AMOUNT" />
			</not>
		</preConditions>
		<addColumn tableName="T_CLAIM_COVERAGE">
			<column name="NOTIFICATION_AMOUNT" type="DECIMAL(18, 2)" />
		</addColumn>
	</changeSet>

	<changeSet author="xin.shi" id="T_CLAIM_COVERAGE.LIABILITY_STATUS"
		runOnChange="true">
		<preConditions onFail="MARK_RAN" onFailMessage="LIABILITY_STATUS not exists">
			<columnExists tableName="T_CLAIM_COVERAGE" columnName="LIABILITY_STATUS" />
		</preConditions>
		<dropColumn tableName="T_CLAIM_COVERAGE" columnName="LIABILITY_STATUS" />
	</changeSet>

	<changeSet author="xin.shi" id="T_CLAIM_COVERAGE.TERMINATE_DATE"
		runOnChange="true">
		<preConditions onFail="MARK_RAN" onFailMessage="TERMINATE_DATE exists">
			<not>
				<columnExists tableName="T_CLAIM_COVERAGE" columnName="TERMINATE_DATE" />
			</not>
		</preConditions>
		<addColumn tableName="T_CLAIM_COVERAGE">
			<column name="TERMINATE_DATE" type="datetime" />
		</addColumn>
	</changeSet>

	<changeSet author="xin.shi" id="T_CLAIM_COVERAGE.DECIMAL.CHANGE"
		runOnChange="true">
		<modifyDataType columnName="PAY_AMOUNT" newDataType="DECIMAL(18, 6)"
			tableName="T_CLAIM_COVERAGE" />
		<modifyDataType columnName="NOTIFICATION_AMOUNT"
			newDataType="DECIMAL(18, 6)" tableName="T_CLAIM_COVERAGE" />
		<modifyDataType columnName="PREMIUM" newDataType="DECIMAL(18, 6)"
			tableName="T_CLAIM_COVERAGE" />
		<modifyDataType columnName="SUM_ASSURED" newDataType="DECIMAL(18, 6)"
			tableName="T_CLAIM_COVERAGE" />
	</changeSet>

	<changeSet author="xin.shi" id="T_CLAIM_COVERAGE.TERMINATE_INDI.TOSTRING"
		runOnChange="true">
		<modifyDataType columnName="TERMINATE_INDI"
			newDataType="VARCHAR(1)" tableName="T_CLAIM_COVERAGE" />
		<update tableName="T_CLAIM_COVERAGE">
			<column name="TERMINATE_INDI" type="VARCHAR(1)" value="Y" />
			<where>TERMINATE_INDI = '1'</where>
		</update>
		<update tableName="T_CLAIM_COVERAGE">
			<column name="TERMINATE_INDI" type="VARCHAR(1)" value="N" />
			<where>TERMINATE_INDI = '0'</where>
		</update>
	</changeSet>
	
	<changeSet author="xin.shi" id="T_CLAIM_COVERAGE.ADD_WAIVED_INDI"
		runOnChange="true">
		<preConditions onFail="MARK_RAN" onFailMessage="WAIVED_INDI exists">
			<not>
				<columnExists tableName="T_CLAIM_COVERAGE" columnName="WAIVED_INDI" />
			</not>
		</preConditions>
		<addColumn tableName="T_CLAIM_COVERAGE">
			<column name="WAIVED_INDI" type="VARCHAR(1)" />
		</addColumn>
	</changeSet>

    <changeSet author="generated" id="createIndex-claim-coverage-policyId">
      <createIndex indexName="idx_claim_coverage_policyId" tableName="T_CLAIM_COVERAGE">
        <column name="CLAIM_POLICY_ID" type="${uuid_type}" />
      </createIndex>
    </changeSet>

    <changeSet author="generated" id="createIndex-claim-coverage-coverageNo">
      <createIndex indexName="idx_claim_coverage_coverageNo" tableName="T_CLAIM_COVERAGE">
        <column name="COVERAGE_NO" type="VARCHAR(50)" />
      </createIndex>
    </changeSet>
    
   <changeSet author="xin.shi" id="T_CLAIM_COVERAGE.REJECT_REASON_DESC_change_length"
    runOnChange="true">
    <modifyDataType columnName="REJECT_REASON_DESC" newDataType="VARCHAR(400)"
      tableName="T_CLAIM_COVERAGE" />
  </changeSet>
</databaseChangeLog>
